import streamlit as st
import pandas as pd
import numpy as np
import datetime
from datetime import timedelta
import random
import time

# íŽ˜ì´ì§€ êµ¬ì„± ì„¤ì •
st.set_page_config(
    page_title="ì¹¨í•´ì‚¬ê³  ë¶„ì„ ì‹œìŠ¤í…œ",
    page_icon="ðŸ”",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ì‚¬ì´ë“œë°” ì„¤ì •
st.sidebar.title("ì¹¨í•´ì‚¬ê³  íƒ€ìž„ë¼ì¸ ë¶„ì„ ì‹œìŠ¤í…œ")
st.sidebar.image("https://www.kisa.or.kr/images/common/logo.png", width=200)

# ë©”ë‰´ ì„ íƒ
menu = st.sidebar.selectbox(
    "ë©”ë‰´ ì„ íƒ",
    ["ëŒ€ì‹œë³´ë“œ", "íƒ€ìž„ë¼ì¸ ë¶„ì„", "RAG ê²€ìƒ‰ ì‹œìŠ¤í…œ", "ì§ˆì˜ì‘ë‹µ(QA)"]
)

# í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
def generate_sample_logs(num_entries=100):
    log_types = ["ë„¤íŠ¸ì›Œí¬ ë¡œê·¸", "ì‹œìŠ¤í…œ ë¡œê·¸", "ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸", "ë³´ì•ˆìž¥ë¹„ ë¡œê·¸", "ë°©í™”ë²½ ë¡œê·¸"]
    event_types = ["ë¡œê·¸ì¸ ì‹œë„", "ì ‘ê·¼ ê±°ë¶€", "íŒŒì¼ ìˆ˜ì •", "íŒ¨í‚· ìŠ¤ìº”", "ê³„ì • ìƒì„±", "ê¶Œí•œ ë³€ê²½", "ë°ì´í„° ìœ ì¶œ ì‹œë„"]
    ip_addresses = [f"192.168.1.{i}" for i in range(1, 20)] + [f"10.0.0.{i}" for i in range(1, 20)]
    users = ["admin", "user1", "user2", "system", "root", "guest", "unknown"]
    
    start_date = datetime.datetime(2025, 4, 1, 0, 0, 0)
    
    logs = []
    for i in range(num_entries):
        timestamp = start_date + timedelta(
            days=random.randint(0, 30),
            hours=random.randint(0, 23),
            minutes=random.randint(0, 59),
            seconds=random.randint(0, 59)
        )
        
        log_type = random.choice(log_types)
        event_type = random.choice(event_types)
        source_ip = random.choice(ip_addresses)
        destination_ip = random.choice(ip_addresses)
        while destination_ip == source_ip:
            destination_ip = random.choice(ip_addresses)
        user = random.choice(users)
        severity = random.choice(["ë‚®ìŒ", "ì¤‘ê°„", "ë†’ìŒ", "ì‹¬ê°"])
        
        logs.append({
            "íƒ€ìž„ìŠ¤íƒ¬í”„": timestamp,
            "ë¡œê·¸ìœ í˜•": log_type,
            "ì´ë²¤íŠ¸": event_type,
            "ì¶œë°œì§€IP": source_ip,
            "ëª©ì ì§€IP": destination_ip,
            "ì‚¬ìš©ìž": user,
            "ì‹¬ê°ë„": severity
        })
    
    return pd.DataFrame(logs)

# í´ëŸ¬ìŠ¤í„°ë§ëœ íƒ€ìž„ë¼ì¸ ë‹¨ê³„ ìƒ˜í”Œ ìƒì„±
def generate_timeline_clusters():
    stages = [
        {"ë‹¨ê³„": "ì´ˆê¸° ì ‘ê·¼", "ì‹œìž‘ì‹œê°„": "2025-04-02 08:23:15", "ì¢…ë£Œì‹œê°„": "2025-04-02 09:45:30", "ì„¤ëª…": "ê³µê²©ìžì˜ ì´ˆê¸° ì‹œìŠ¤í…œ ì ‘ê·¼ ì‹œë„", "ë¡œê·¸ìˆ˜": 28},
        {"ë‹¨ê³„": "ê¶Œí•œ ìƒìŠ¹", "ì‹œìž‘ì‹œê°„": "2025-04-02 10:12:43", "ì¢…ë£Œì‹œê°„": "2025-04-02 11:30:22", "ì„¤ëª…": "ì‹œìŠ¤í…œ ê¶Œí•œ íšë“ ì‹œë„", "ë¡œê·¸ìˆ˜": 45},
        {"ë‹¨ê³„": "ë‚´ë¶€ ì •ì°°", "ì‹œìž‘ì‹œê°„": "2025-04-02 13:05:17", "ì¢…ë£Œì‹œê°„": "2025-04-02 15:28:45", "ì„¤ëª…": "ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ íƒìƒ‰ í™œë™", "ë¡œê·¸ìˆ˜": 67},
        {"ë‹¨ê³„": "ë°ì´í„° ìˆ˜ì§‘", "ì‹œìž‘ì‹œê°„": "2025-04-03 09:14:32", "ì¢…ë£Œì‹œê°„": "2025-04-03 11:45:18", "ì„¤ëª…": "ë¯¼ê° ì •ë³´ ìˆ˜ì§‘ ì‹œë„", "ë¡œê·¸ìˆ˜": 39},
        {"ë‹¨ê³„": "ë°ì´í„° ìœ ì¶œ", "ì‹œìž‘ì‹œê°„": "2025-04-03 14:20:55", "ì¢…ë£Œì‹œê°„": "2025-04-03 16:10:42", "ì„¤ëª…": "ì™¸ë¶€ë¡œ ë°ì´í„° ì „ì†¡ ì‹œë„", "ë¡œê·¸ìˆ˜": 52}
    ]
    return pd.DataFrame(stages)

# RAG ê²€ìƒ‰ ê²°ê³¼ ì‹œë®¬ë ˆì´ì…˜
def simulate_rag_search(query, n=5):
    search_results = [
        {"ì œëª©": "APT ê³µê²© ì¹¨í•´ì‚¬ê³  ë¶„ì„ ë³´ê³ ì„œ", "ê´€ë ¨ë„": 0.92, "ë‚´ìš©": "APT ê³µê²©ì—ì„œëŠ” ì´ˆê¸° ì ‘ê·¼ í›„ ê¶Œí•œ ìƒìŠ¹ ì‹œë„ê°€ ì¼ë°˜ì ìœ¼ë¡œ ê´€ì°°ë©ë‹ˆë‹¤. ê³µê²©ìžëŠ” ì£¼ë¡œ í”¼ì‹± ì´ë©”ì¼ì„ í†µí•´ ì´ˆê¸° ì ‘ê·¼ì„ ì‹œë„í•˜ë©°..."},
        {"ì œëª©": "ëžœì„¬ì›¨ì–´ ê³µê²© íŒ¨í„´ ë¶„ì„", "ê´€ë ¨ë„": 0.87, "ë‚´ìš©": "ëžœì„¬ì›¨ì–´ ê³µê²©ìžëŠ” ì‹œìŠ¤í…œ ì ‘ê·¼ í›„ ì£¼ìš” ë°ì´í„°ë¥¼ ì‹ë³„í•˜ê³  ì•”í˜¸í™”í•˜ê¸° ìœ„í•´ ë‚´ë¶€ ì •ì°°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤..."},
        {"ì œëª©": "ë‚´ë¶€ ì •ì°° ê¸°ìˆ  ë¶„ì„", "ê´€ë ¨ë„": 0.85, "ë‚´ìš©": "ê³µê²©ìžëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ìŠ¤ìºë‹ ë„êµ¬ì™€ PowerShell ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤..."},
        {"ì œëª©": "ê¶Œí•œ ìƒìŠ¹ ê³µê²© ê¸°ë²•", "ê´€ë ¨ë„": 0.81, "ë‚´ìš©": "ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ê³µê²©ìžëŠ” ì·¨ì•½í•œ ì„œë¹„ìŠ¤, íŒ¨ì¹˜ë˜ì§€ ì•Šì€ ì†Œí”„íŠ¸ì›¨ì–´, ì„¤ì • ì˜¤ë¥˜ ë“±ì„ ì´ìš©í•©ë‹ˆë‹¤..."},
        {"ì œëª©": "ë°ì´í„° ìœ ì¶œ íƒì§€ ë°©ë²•", "ê´€ë ¨ë„": 0.78, "ë‚´ìš©": "ë°ì´í„° ìœ ì¶œì€ ë¹„ì •ìƒì ì¸ ë„¤íŠ¸ì›Œí¬ íŠ¸ëž˜í”½ íŒ¨í„´, ëŒ€ìš©ëŸ‰ íŒŒì¼ ì „ì†¡, ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ì˜ í™œë™ ë“±ì„ í†µí•´ íƒì§€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤..."},
        {"ì œëª©": "MITRE ATT&CK í”„ë ˆìž„ì›Œí¬", "ê´€ë ¨ë„": 0.75, "ë‚´ìš©": "MITRE ATT&CK í”„ë ˆìž„ì›Œí¬ëŠ” ì¹¨í•´ì‚¬ê³ ì˜ ë‹¤ì–‘í•œ ë‹¨ê³„ì™€ ê¸°ë²•ì„ ì²´ê³„ì ìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤..."},
        {"ì œëª©": "ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§", "ê´€ë ¨ë„": 0.72, "ë‚´ìš©": "íš¨ê³¼ì ì¸ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ì€ ì¹¨í•´ì‚¬ê³ ì˜ ì¡°ê¸° íƒì§€ì— í•„ìˆ˜ì ì´ë©°, ì´ìƒ íŠ¸ëž˜í”½ íŒ¨í„´ì„ ì‹ë³„í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤..."}
    ]
    
    # ì¿¼ë¦¬ì— ë”°ë¼ ê´€ë ¨ë„ ì•½ê°„ ì¡°ì • (ì‹œë®¬ë ˆì´ì…˜)
    for result in search_results:
        noise = random.uniform(-0.1, 0.1)
        result["ê´€ë ¨ë„"] = min(0.99, max(0.5, result["ê´€ë ¨ë„"] + noise))
    
    # ê´€ë ¨ë„ ìˆœìœ¼ë¡œ ì •ë ¬
    search_results = sorted(search_results, key=lambda x: x["ê´€ë ¨ë„"], reverse=True)
    
    return search_results[:n]

# LLM ë¶„ì„ ê²°ê³¼ ì‹œë®¬ë ˆì´ì…˜
def simulate_llm_analysis(timeline_data):
    analysis = """
    ### ì¹¨í•´ì‚¬ê³  ë¶„ì„ ìš”ì•½

    ë¶„ì„ëœ ë¡œê·¸ ë°ì´í„°ì— ë”°ë¥´ë©´, ì´ ì¹¨í•´ì‚¬ê³ ëŠ” ì „í˜•ì ì¸ APT(Advanced Persistent Threat) ê³µê²© íŒ¨í„´ì„ ë³´ì´ê³  ìžˆìŠµë‹ˆë‹¤. ê³µê²© ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ì´ ìš”ì•½í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤:

    1. **ì´ˆê¸° ì ‘ê·¼ (2025-04-02 08:23:15 ~ 09:45:30)**
       - í”¼ì‹± ì´ë©”ì¼ì„ í†µí•´ ë‚´ë¶€ ì‹œìŠ¤í…œì— ìµœì´ˆ ì ‘ê·¼
       - ì‚¬ìš©ìž ê³„ì • ì¸ì¦ ì •ë³´ íƒˆì·¨ ì‹œë„ í”ì  ë°œê²¬

    2. **ê¶Œí•œ ìƒìŠ¹ (2025-04-02 10:12:43 ~ 11:30:22)**
       - ì·¨ì•½í•œ ì„œë¹„ìŠ¤ ì´ìš©í•œ ê¶Œí•œ ìƒìŠ¹ ì‹œë„
       - ê´€ë¦¬ìž ê¶Œí•œ íšë“ í”ì  ë°œê²¬

    3. **ë‚´ë¶€ ì •ì°° (2025-04-02 13:05:17 ~ 15:28:45)**
       - ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ìŠ¤ìº” í™œë™ ë‹¤ìˆ˜ ë°œê²¬
       - ì£¼ìš” ì„œë²„ ë° ë°ì´í„°ë² ì´ìŠ¤ ìœ„ì¹˜ ì‹ë³„ ì‹œë„

    4. **ë°ì´í„° ìˆ˜ì§‘ (2025-04-03 09:14:32 ~ 11:45:18)**
       - ì£¼ìš” ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì‹œë„
       - ëŒ€ìš©ëŸ‰ ë°ì´í„° ì¿¼ë¦¬ ë° ìˆ˜ì§‘ í™œë™

    5. **ë°ì´í„° ìœ ì¶œ (2025-04-03 14:20:55 ~ 16:10:42)**
       - ì™¸ë¶€ C&C ì„œë²„ë¡œì˜ ë°ì´í„° ì „ì†¡ ì‹œë„
       - ì•”í˜¸í™”ëœ ì±„ë„ì„ í†µí•œ ë°ì´í„° ìœ ì¶œ í”ì 

    ê³µê²© IP ì£¼ì†Œì™€ ì•…ì„± ë„ë©”ì¸ ë¶„ì„ ê²°ê³¼, ì´ ê³µê²©ì€ ì•Œë ¤ì§„ ìœ„í˜‘ ê·¸ë£¹ 'APT-X'ì˜ ê³µê²© íŒ¨í„´ê³¼ ìœ ì‚¬ì„±ì„ ë³´ìž…ë‹ˆë‹¤. í•´ë‹¹ ê·¸ë£¹ì€ ì£¼ë¡œ ê¸ˆìœµ ë° ê¸°ìˆ  ê¸°ì—…ì„ ëŒ€ìƒìœ¼ë¡œ ì§€ì  ìž¬ì‚°ê¶Œ ë° ê³ ê° ë°ì´í„° ìœ ì¶œì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.

    ê¶Œìž¥ ëŒ€ì‘ ì¡°ì¹˜:
    - ì˜í–¥ ë°›ì€ ì‹œìŠ¤í…œ ê²©ë¦¬ ë° í¬ë Œì‹ ë¶„ì„
    - ê´€ë¦¬ìž ê³„ì • íŒ¨ìŠ¤ì›Œë“œ ì „ì²´ ë¦¬ì…‹
    - ë„¤íŠ¸ì›Œí¬ ì„¸ê·¸ë¨¼í…Œì´ì…˜ ê°•í™”
    - ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì™¸ë¶€ ì—°ê²° ì°¨ë‹¨
    - EDR ì†”ë£¨ì…˜ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ ê°•í™”
    """
    return analysis

# ì§ˆì˜ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
def simulate_qa(question):
    qa_responses = {
        "ê³µê²©ì˜ ì£¼ìš” ë‹¨ê³„ëŠ” ë¬´ì—‡ì¸ê°€ìš”?": "ì´ ì¹¨í•´ì‚¬ê³ ì˜ ì£¼ìš” ë‹¨ê³„ëŠ” 1) ì´ˆê¸° ì ‘ê·¼, 2) ê¶Œí•œ ìƒìŠ¹, 3) ë‚´ë¶€ ì •ì°°, 4) ë°ì´í„° ìˆ˜ì§‘, 5) ë°ì´í„° ìœ ì¶œì˜ 5ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì „í˜•ì ì¸ APT ê³µê²©ì˜ í‚¬ì²´ì¸ íŒ¨í„´ì„ ë”°ë¥´ê³  ìžˆìŠµë‹ˆë‹¤.",
        "ì´ˆê¸° ì ‘ê·¼ì€ ì–´ë–»ê²Œ ì´ë£¨ì–´ì¡Œë‚˜ìš”?": "ë¡œê·¸ ë¶„ì„ ê²°ê³¼, ì´ˆê¸° ì ‘ê·¼ì€ í”¼ì‹± ì´ë©”ì¼ì„ í†µí•´ ì´ë£¨ì–´ì§„ ê²ƒìœ¼ë¡œ ì¶”ì •ë©ë‹ˆë‹¤. ì‚¬ìš©ìžê°€ ì•…ì„± ì²¨ë¶€íŒŒì¼ì„ ì‹¤í–‰í•˜ë©´ì„œ ê³µê²©ìžê°€ ì‹œìŠ¤í…œì— ìµœì´ˆ ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.",
        "ì–´ë–¤ ë°ì´í„°ê°€ ìœ ì¶œë˜ì—ˆë‚˜ìš”?": "ë¡œê·¸ ë¶„ì„ì— ë”°ë¥´ë©´ ì£¼ë¡œ ê³ ê° ì •ë³´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë‚´ë¶€ ê¸°ìˆ  ë¬¸ì„œì— ì ‘ê·¼í•œ í”ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì•½ 2GB ìƒë‹¹ì˜ ë°ì´í„°ê°€ ì™¸ë¶€ ì„œë²„ë¡œ ì „ì†¡ëœ ê²ƒìœ¼ë¡œ ì¶”ì •ë©ë‹ˆë‹¤.",
        "ì¶”ì²œí•˜ëŠ” ëŒ€ì‘ ì¡°ì¹˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?": "ê¶Œìž¥ ëŒ€ì‘ ì¡°ì¹˜ë¡œëŠ” 1) ì˜í–¥ ë°›ì€ ì‹œìŠ¤í…œ ê²©ë¦¬ ë° í¬ë Œì‹ ë¶„ì„, 2) ê´€ë¦¬ìž ê³„ì • íŒ¨ìŠ¤ì›Œë“œ ì „ì²´ ë¦¬ì…‹, 3) ë„¤íŠ¸ì›Œí¬ ì„¸ê·¸ë¨¼í…Œì´ì…˜ ê°•í™”, 4) ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì™¸ë¶€ ì—°ê²° ì°¨ë‹¨, 5) EDR ì†”ë£¨ì…˜ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ ê°•í™”ê°€ ìžˆìŠµë‹ˆë‹¤.",
        "ê³µê²©ìžëŠ” ëˆ„êµ¬ì¸ê°€ìš”?": "ê³µê²© íŒ¨í„´ê³¼ ì‚¬ìš©ëœ ë„êµ¬, ê·¸ë¦¬ê³  C&C ì„œë²„ ë¶„ì„ ê²°ê³¼, ì´ ê³µê²©ì€ 'APT-X'ë¼ëŠ” ì•Œë ¤ì§„ ìœ„í˜‘ ê·¸ë£¹ê³¼ ì—°ê´€ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì´ ê·¸ë£¹ì€ ì£¼ë¡œ ê¸ˆìœµ ë° ê¸°ìˆ  ê¸°ì—…ì„ ëŒ€ìƒìœ¼ë¡œ í•œ ì§€ì  ìž¬ì‚°ê¶Œ ë° ê³ ê° ë°ì´í„° ìœ ì¶œ í™œë™ì„ ì „ê°œí•´ ì™”ìŠµë‹ˆë‹¤."
    }
    
    # ê¸°ë³¸ ì‘ë‹µ
    default_response = "í•´ë‹¹ ì§ˆë¬¸ì— ëŒ€í•œ ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•˜ê¸° ìœ„í•´ ë” ë§Žì€ ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤. ì¶”ê°€ ì •ë³´ê°€ ìžˆìœ¼ì‹œë©´ ì•Œë ¤ì£¼ì„¸ìš”."
    
    # ì§ˆë¬¸ì— ëŒ€í•œ ê°€ìž¥ ì—°ê´€ì„± ë†’ì€ ì‘ë‹µ ì°¾ê¸°
    best_answer = default_response
    best_score = 0
    
    for key_q, answer in qa_responses.items():
        # ê°„ë‹¨í•œ í‚¤ì›Œë“œ ë§¤ì¹­ (ì‹¤ì œë¡œëŠ” ë” ë³µìž¡í•œ ìœ ì‚¬ë„ ì¸¡ì • í•„ìš”)
        score = sum(word in question.lower() for word in key_q.lower().split())
        if score > best_score:
            best_score = score
            best_answer = answer
    
    # ë¹„ìŠ·í•œ ì§ˆë¬¸ì´ ì—†ìœ¼ë©´ ì¼ë¶€ í‚¤ì›Œë“œì— ê¸°ë°˜í•˜ì—¬ ì¶”ì¸¡
    if best_score == 0:
        if "ë‹¨ê³„" in question.lower() or "ê³¼ì •" in question.lower():
            best_answer = qa_responses["ê³µê²©ì˜ ì£¼ìš” ë‹¨ê³„ëŠ” ë¬´ì—‡ì¸ê°€ìš”?"]
        elif "ì ‘ê·¼" in question.lower() or "ì‹œìž‘" in question.lower():
            best_answer = qa_responses["ì´ˆê¸° ì ‘ê·¼ì€ ì–´ë–»ê²Œ ì´ë£¨ì–´ì¡Œë‚˜ìš”?"]
        elif "ë°ì´í„°" in question.lower() or "ìœ ì¶œ" in question.lower():
            best_answer = qa_responses["ì–´ë–¤ ë°ì´í„°ê°€ ìœ ì¶œë˜ì—ˆë‚˜ìš”?"]
        elif "ëŒ€ì‘" in question.lower() or "ì¡°ì¹˜" in question.lower() or "ë°©ì–´" in question.lower():
            best_answer = qa_responses["ì¶”ì²œí•˜ëŠ” ëŒ€ì‘ ì¡°ì¹˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?"]
        elif "ê³µê²©ìž" in question.lower() or "ëˆ„êµ¬" in question.lower() or "ê·¸ë£¹" in question.lower():
            best_answer = qa_responses["ê³µê²©ìžëŠ” ëˆ„êµ¬ì¸ê°€ìš”?"]
    
    return best_answer

# ìƒ˜í”Œ ë°ì´í„° ìƒì„±
logs_df = generate_sample_logs(150)
timeline_df = generate_timeline_clusters()

# 1. ëŒ€ì‹œë³´ë“œ
if menu == "ëŒ€ì‹œë³´ë“œ":
    st.title("ì¹¨í•´ì‚¬ê³  ë¶„ì„ ëŒ€ì‹œë³´ë“œ")
    
    # ì£¼ìš” ì§€í‘œ í‘œì‹œ
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        st.metric(label="íƒì§€ëœ ë¡œê·¸ ìˆ˜", value=f"{len(logs_df):,}")
    with col2:
        st.metric(label="íƒì§€ëœ íƒ€ìž„ë¼ì¸ ë‹¨ê³„", value=len(timeline_df))
    with col3:
        st.metric(label="ì˜í–¥ ë°›ì€ ì‹œìŠ¤í…œ", value="12")
    with col4:
        st.metric(label="ì‹¬ê°ë„", value="ë†’ìŒ", delta="ì¦ê°€")
    
    # íƒ€ìž„ë¼ì¸ ìš”ì•½ í‘œ
    st.subheader("ì¹¨í•´ì‚¬ê³  íƒ€ìž„ë¼ì¸ ìš”ì•½")
    
    # íƒ€ìž„ë¼ì¸ ë°ì´í„° í‘œì‹œ
    st.dataframe(timeline_df)
    
    # ë¡œê·¸ ìœ í˜• ë° ì‹¬ê°ë„ ë¶„í¬
    col1, col2 = st.columns(2)
    
    with col1:
        st.subheader("ë¡œê·¸ ìœ í˜• ë¶„í¬")
        log_type_counts = logs_df["ë¡œê·¸ìœ í˜•"].value_counts()
        st.bar_chart(log_type_counts)
        
    with col2:
        st.subheader("ì‹¬ê°ë„ ë¶„í¬")
        severity_counts = logs_df["ì‹¬ê°ë„"].value_counts()
        st.bar_chart(severity_counts)
    
    # ìµœê·¼ ë¡œê·¸ í‘œì‹œ
    st.subheader("ìµœê·¼ ë¡œê·¸")
    st.dataframe(logs_df.sort_values("íƒ€ìž„ìŠ¤íƒ¬í”„", ascending=False).head(10))
    
    # LLM ë¶„ì„ ê²°ê³¼ í‘œì‹œ
    st.subheader("ì¹¨í•´ì‚¬ê³  ë¶„ì„ ìš”ì•½")
    st.markdown(simulate_llm_analysis(timeline_df))

# 2. íƒ€ìž„ë¼ì¸ ë¶„ì„
elif menu == "íƒ€ìž„ë¼ì¸ ë¶„ì„":
    st.title("ì¹¨í•´ì‚¬ê³  íƒ€ìž„ë¼ì¸ ë¶„ì„")
    
    st.markdown("""
    íƒ€ìž„ë¼ì¸ ë¶„ì„ì—ì„œëŠ” ë¡œê·¸ í´ëŸ¬ìŠ¤í„°ë§ì„ í†µí•´ ìžë™ìœ¼ë¡œ ìƒì„±ëœ ì¹¨í•´ì‚¬ê³  íƒ€ìž„ë¼ì¸ì„ ìƒì„¸ížˆ ì‚´íŽ´ë³¼ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    ê° ë‹¨ê³„ì—ì„œ ì–´ë–¤ í™œë™ì´ ë°œìƒí–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ë‹¨ê³„ ê°„ì˜ ê´€ê³„ë¥¼ ë¶„ì„í•˜ì—¬ ê³µê²©ì˜ ì§„í–‰ ê³¼ì •ì„ ì´í•´í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    """)
    
    # ë‹¨ê³„ë³„ ìƒì„¸ ì •ë³´ í‘œì‹œ
    for i, row in timeline_df.iterrows():
        with st.expander(f"{row['ë‹¨ê³„']} ({row['ì‹œìž‘ì‹œê°„']} ~ {row['ì¢…ë£Œì‹œê°„']})"):
            st.markdown(f"**ì„¤ëª…**: {row['ì„¤ëª…']}")
            st.markdown(f"**ë¡œê·¸ ìˆ˜**: {row['ë¡œê·¸ìˆ˜']}")
            
            # í•´ë‹¹ ë‹¨ê³„ì˜ ë¡œê·¸ í‘œì‹œ (ì‹œë®¬ë ˆì´ì…˜)
            stage_start = datetime.datetime.strptime(row['ì‹œìž‘ì‹œê°„'], "%Y-%m-%d %H:%M:%S")
            stage_end = datetime.datetime.strptime(row['ì¢…ë£Œì‹œê°„'], "%Y-%m-%d %H:%M:%S")
            
            # í•´ë‹¹ ì‹œê°„ëŒ€ì˜ ë¡œê·¸ í•„í„°ë§
            stage_logs = logs_df[(logs_df["íƒ€ìž„ìŠ¤íƒ¬í”„"] >= stage_start) & (logs_df["íƒ€ìž„ìŠ¤íƒ¬í”„"] <= stage_end)]
            
            if not stage_logs.empty:
                st.markdown("#### ì£¼ìš” ë¡œê·¸")
                st.dataframe(stage_logs.head(5))
                
                # ë¡œê·¸ ìœ í˜• ë¶„í¬
                log_types = stage_logs["ë¡œê·¸ìœ í˜•"].value_counts()
                st.bar_chart(log_types)
                
                # ë‹¨ê³„ë³„ ë¶„ì„ ê²°ê³¼ (ì‹œë®¬ë ˆì´ì…˜)
                st.markdown("#### ë¶„ì„ ê²°ê³¼")
                
                if row['ë‹¨ê³„'] == "ì´ˆê¸° ì ‘ê·¼":
                    st.markdown("""
                    ì´ ë‹¨ê³„ì—ì„œëŠ” ê³µê²©ìžê°€ í”¼ì‹± ì´ë©”ì¼ì„ í†µí•´ ë‚´ë¶€ ì‹œìŠ¤í…œì— ì ‘ê·¼í•œ ê²ƒìœ¼ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.
                    ì‚¬ìš©ìž ê³„ì • ì¸ì¦ ì‹œë„ê°€ ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ì— ë‹¤ìˆ˜ ë°œìƒí–ˆìœ¼ë©°, ì˜ì‹¬ìŠ¤ëŸ¬ìš´ IP ì£¼ì†Œë¡œë¶€í„°ì˜ ì ‘ê·¼ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
                    """)
                elif row['ë‹¨ê³„'] == "ê¶Œí•œ ìƒìŠ¹":
                    st.markdown("""
                    ì´ ë‹¨ê³„ì—ì„œëŠ” ê³µê²©ìžê°€ ì·¨ì•½í•œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ì¼ë°˜ ì‚¬ìš©ìž ê¶Œí•œì—ì„œ ê´€ë¦¬ìž ê¶Œí•œìœ¼ë¡œ ìƒìŠ¹ì„ ì‹œë„í–ˆìŠµë‹ˆë‹¤.
                    ë¡œê·¸ ë¶„ì„ ê²°ê³¼, ì—¬ëŸ¬ ë²ˆì˜ ê¶Œí•œ ìƒìŠ¹ ì‹œë„ê°€ í™•ì¸ë˜ì—ˆìœ¼ë©°, ê²°êµ­ ì„±ê³µí•œ ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤.
                    """)
                elif row['ë‹¨ê³„'] == "ë‚´ë¶€ ì •ì°°":
                    st.markdown("""
                    ì´ ë‹¨ê³„ì—ì„œëŠ” ê³µê²©ìžê°€ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ íƒìƒ‰í•˜ë©° ì£¼ìš” ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í–ˆìŠµë‹ˆë‹¤.
                    ë„¤íŠ¸ì›Œí¬ ìŠ¤ìº” ë„êµ¬ì™€ PowerShell ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•œ í”ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                    """)
                elif row['ë‹¨ê³„'] == "ë°ì´í„° ìˆ˜ì§‘":
                    st.markdown("""
                    ì´ ë‹¨ê³„ì—ì„œëŠ” ê³µê²©ìžê°€ ì£¼ìš” ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ì—¬ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œ ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤.
                    íŠ¹ížˆ ê³ ê° ì •ë³´ì™€ ë‚´ë¶€ ê¸°ìˆ  ë¬¸ì„œì— ì ‘ê·¼í•œ í”ì ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
                    """)
                elif row['ë‹¨ê³„'] == "ë°ì´í„° ìœ ì¶œ":
                    st.markdown("""
                    ì´ ë‹¨ê³„ì—ì„œëŠ” ìˆ˜ì§‘ëœ ë°ì´í„°ê°€ ì™¸ë¶€ C&C ì„œë²„ë¡œ ì „ì†¡ëœ ê²ƒìœ¼ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.
                    ì•”í˜¸í™”ëœ ì±„ë„ì„ í†µí•´ ì•½ 2GB ìƒë‹¹ì˜ ë°ì´í„°ê°€ ìœ ì¶œëœ ê²ƒìœ¼ë¡œ ì¶”ì •ë©ë‹ˆë‹¤.
                    """)
    
    # MITRE ATT&CK ë§¤í•‘
    st.subheader("MITRE ATT&CK ë§¤í•‘")
    st.markdown("""
    íƒì§€ëœ íƒ€ìž„ë¼ì¸ ë‹¨ê³„ëŠ” MITRE ATT&CK í”„ë ˆìž„ì›Œí¬ì˜ ë‹¤ìŒ ì „ìˆ ì— ë§¤í•‘ë©ë‹ˆë‹¤:
    - **ì´ˆê¸° ì ‘ê·¼**: Initial Access (TA0001)
    - **ê¶Œí•œ ìƒìŠ¹**: Privilege Escalation (TA0004)
    - **ë‚´ë¶€ ì •ì°°**: Discovery (TA0007)
    - **ë°ì´í„° ìˆ˜ì§‘**: Collection (TA0009)
    - **ë°ì´í„° ìœ ì¶œ**: Exfiltration (TA0010)
    """)
    
    # ê°„ì†Œí™”ëœ íƒ€ìž„ë¼ì¸ ì‹œê°í™”
    st.subheader("íƒ€ìž„ë¼ì¸ ì‹œê°í™”")
    
    # íƒ€ìž„ë¼ì¸ ë°ì´í„°ë¥¼ í‘œ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
    st.table(timeline_df[['ë‹¨ê³„', 'ì‹œìž‘ì‹œê°„', 'ì¢…ë£Œì‹œê°„', 'ë¡œê·¸ìˆ˜']])
    
    # ë‹¨ê³„ë³„ ë¡œê·¸ìˆ˜ë¥¼ ë°” ì°¨íŠ¸ë¡œ í‘œì‹œ
    st.bar_chart(timeline_df.set_index('ë‹¨ê³„')['ë¡œê·¸ìˆ˜'])

# 3. RAG ê²€ìƒ‰ ì‹œìŠ¤í…œ
elif menu == "RAG ê²€ìƒ‰ ì‹œìŠ¤í…œ":
    st.title("RAG ê¸°ë°˜ ì¹¨í•´ì‚¬ê³  ë¶„ì„ ê²€ìƒ‰ ì‹œìŠ¤í…œ")
    
    st.markdown("""
    RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ ê³¼ê±° ì¹¨í•´ì‚¬ê³  ë¶„ì„ ìžë£Œ, ìœ„í˜‘ ì¸í…”ë¦¬ì „ìŠ¤, ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€ ë“±ì—ì„œ
    ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  í˜„ìž¬ ë¶„ì„ ì¤‘ì¸ ì‚¬ë¡€ì— ì ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    """)
    
    # ê²€ìƒ‰ì°½
    query = st.text_input("ê²€ìƒ‰ì–´ë¥¼ ìž…ë ¥í•˜ì„¸ìš”:", "APT ê³µê²© íŒ¨í„´")
    
    if query:
        with st.spinner("ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰ ì¤‘ìž…ë‹ˆë‹¤..."):
            # ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ ìž„ë² ë”© ë° ë²¡í„° ê²€ìƒ‰ì„ ìˆ˜í–‰
            time.sleep(1)  # ê²€ìƒ‰ ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜
            search_results = simulate_rag_search(query)
        
        # ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        st.subheader("ê²€ìƒ‰ ê²°ê³¼")
        
        for i, result in enumerate(search_results):
            with st.expander(f"{result['ì œëª©']} (ê´€ë ¨ë„: {result['ê´€ë ¨ë„']:.2f})"):
                st.markdown(result['ë‚´ìš©'])
                st.progress(result['ê´€ë ¨ë„'])
        
        # í†µí•© ë¶„ì„ ê²°ê³¼
        st.subheader("í†µí•© ë¶„ì„")
        
        # ê²€ìƒ‰ì–´ì— ë”°ë¼ ë‹¤ë¥¸ ë¶„ì„ ê²°ê³¼ í‘œì‹œ (ì‹œë®¬ë ˆì´ì…˜)
        if "APT" in query:
            st.markdown("""
            ### APT ê³µê²© ë¶„ì„

            ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í˜„ìž¬ ë¶„ì„ ì¤‘ì¸ ì¹¨í•´ì‚¬ê³ ëŠ” APT ê³µê²©ì˜ íŠ¹ì„±ì„ ë³´ì´ê³  ìžˆìŠµë‹ˆë‹¤:

            1. **ì§€ì†ì„±**: ìž¥ê¸°ê°„ì— ê±¸ì¹œ ê³µê²© íŒ¨í„´
            2. **í‘œì ì„±**: íŠ¹ì • ë°ì´í„°ë‚˜ ì‹œìŠ¤í…œì„ ëª©í‘œë¡œ í•œ ê³µê²©
            3. **ì€ë°€ì„±**: íƒì§€ë¥¼ íšŒí”¼í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ê¸°ë²• ì‚¬ìš©
            4. **ê³ ë„í™”**: ë³µìž¡í•œ ê³µê²© ê¸°ë²•ê³¼ ë„êµ¬ í™œìš©

            ì´ëŸ° íŠ¹ì„±ì„ ê³ ë ¤í•  ë•Œ, ì¶”ê°€ì ì¸ ì¡°ì‚¬ê°€ í•„ìš”í•œ ì˜ì—­:
            - ì¹¨í•´ ì‹œìŠ¤í…œ ì™¸ ë‹¤ë¥¸ ì‹œìŠ¤í…œìœ¼ë¡œì˜ ì¸¡ë©´ ì´ë™ í”ì 
            - ì§€ì†ì„± í™•ë³´ë¥¼ ìœ„í•œ ë°±ë„ì–´ ì„¤ì¹˜ ì—¬ë¶€
            - ì£¼ìš” ì¸ì¦ ì‹œìŠ¤í…œì— ëŒ€í•œ ì†ìƒ ì—¬ë¶€
            """)
        elif "ëžœì„¬ì›¨ì–´" in query:
            st.markdown("""
            ### ëžœì„¬ì›¨ì–´ ê³µê²© ë¶„ì„

            ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í˜„ìž¬ ë¶„ì„ ì¤‘ì¸ ì¹¨í•´ì‚¬ê³ ì—ì„œëŠ” ëžœì„¬ì›¨ì–´ ê³µê²©ì˜ íŠ¹ì§•ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ ëžœì„¬ì›¨ì–´ ê³µê²© íŒ¨í„´ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì°¨ì´ì ì´ ìžˆìŠµë‹ˆë‹¤:

            1. **ì•”í˜¸í™” ì‹œë„ ì—†ìŒ**: íŒŒì¼ ì•”í˜¸í™” ì‹œë„ í”ì ì´ ë°œê²¬ë˜ì§€ ì•ŠìŒ
            2. **ëª¸ê°’ ìš”êµ¬ ì—†ìŒ**: ê³µê²©ìžì˜ ëª¸ê°’ ìš”êµ¬ ë©”ì‹œì§€ê°€ ì—†ìŒ
            3. **ë°ì´í„° ìœ ì¶œ ì¤‘ì‹¬**: ì•”í˜¸í™”ë³´ë‹¤ ë°ì´í„° ìœ ì¶œì— ì¤‘ì ì„ ë‘” ê³µê²© íŒ¨í„´

            ì´ëŠ” ëžœì„¬ì›¨ì–´ë³´ë‹¤ëŠ” ë°ì´í„° ìœ ì¶œì„ ëª©ì ìœ¼ë¡œ í•˜ëŠ” ìŠ¤íŒŒì´ì›¨ì–´ ë˜ëŠ” APT ê³µê²©ì— ê°€ê¹Œìš´ íŠ¹ì„±ì„ ë³´ìž…ë‹ˆë‹¤.
            """)
        else:
            st.markdown("""
            ### ì¹¨í•´ì‚¬ê³  ë¶„ì„

            ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, í˜„ìž¬ ì¹¨í•´ì‚¬ê³ ì˜ íŠ¹ì„±ì„ ë¶„ì„í•œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

            1. **ê³µê²© ìœ í˜•**: ì§€ëŠ¥í˜• í‘œì  ê³µê²©(APT) íŠ¹ì„±ì„ ë³´ìž„
            2. **ì£¼ìš” ëª©ì **: ë¯¼ê°í•œ ë°ì´í„° ìœ ì¶œë¡œ ì¶”ì •
            3. **ê³µê²© ë‹¨ê³„**: ì „í˜•ì ì¸ ì‚¬ì´ë²„ í‚¬ì²´ì¸ íŒ¨í„´ì„ ë”°ë¦„
            4. **ìœ„í˜‘ ìˆ˜ì¤€**: ë†’ìŒ (í‘œì í™”ëœ ê³µê²©ìœ¼ë¡œ íŒë‹¨)

            í˜„ìž¬ ì¹¨í•´ì‚¬ê³ ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¨ê³„ë³„ íŠ¹ì„±ì„ ê³ ë ¤í•œ ë§žì¶¤í˜• ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤.
            """)
        
        # ìœ ì‚¬ ì¹¨í•´ì‚¬ê³  ì‚¬ë¡€
        st.subheader("ìœ ì‚¬ ì¹¨í•´ì‚¬ê³  ì‚¬ë¡€")
        
        similar_cases = [
            {"ì œëª©": "2024ë…„ ê¸ˆìœµê¶Œ APT ê³µê²© ì‚¬ë¡€", "ìœ ì‚¬ë„": 0.89, "ì„¤ëª…": "êµ­ë‚´ ì£¼ìš” ê¸ˆìœµì‚¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œ APT ê³µê²© ì‚¬ë¡€ë¡œ, ìœ ì‚¬í•œ íƒ€ìž„ë¼ì¸ê³¼ ê³µê²© íŒ¨í„´ì„ ë³´ìž„"},
            {"ì œëª©": "2023ë…„ ì œì¡°ì—… í‘œì  ë°ì´í„° ìœ ì¶œ ì‚¬ë¡€", "ìœ ì‚¬ë„": 0.75, "ì„¤ëª…": "ìžë™ì°¨ ë¶€í’ˆ ì œì¡°ì‚¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œ ì§€ì ìž¬ì‚° ìœ ì¶œ ê³µê²© ì‚¬ë¡€"}
        ]
        
        for case in similar_cases:
            st.markdown(f"**{case['ì œëª©']}** (ìœ ì‚¬ë„: {case['ìœ ì‚¬ë„']:.2f})")
            st.markdown(case['ì„¤ëª…'])
            st.progress(case['ìœ ì‚¬ë„'])
        
        # ëŒ€ì‘ ê¶Œìž¥ì‚¬í•­
        st.subheader("ëŒ€ì‘ ê¶Œìž¥ì‚¬í•­")
        
        st.markdown("""
        í˜„ìž¬ ì¹¨í•´ì‚¬ê³ ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ëŒ€ì‘ ì¡°ì¹˜ë¥¼ ê¶Œìž¥í•©ë‹ˆë‹¤:
        
        1. **ì¦‰ì‹œ ì¡°ì¹˜ì‚¬í•­**:
           - ì˜í–¥ ë°›ì€ ì‹œìŠ¤í…œ ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬
           - ê´€ë¦¬ìž ê³„ì • íŒ¨ìŠ¤ì›Œë“œ ì „ì²´ ë¦¬ì…‹
           - ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì™¸ë¶€ ì—°ê²° ì°¨ë‹¨
        
        2. **ì¡°ì‚¬ í™•ëŒ€**:
           - ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì „ì²´ì— ëŒ€í•œ IOC ê²€ìƒ‰
           - ìœ ì‚¬í•œ ì¹¨í•´ ì§•í›„ ëª¨ë‹ˆí„°ë§
           - ë°±ë„ì–´ ë° ì§€ì†ì„± í™•ë³´ ìˆ˜ë‹¨ ê²€ìƒ‰
        
        3. **ìž¥ê¸° ëŒ€ì‘**:
           - ë„¤íŠ¸ì›Œí¬ ì„¸ê·¸ë¨¼í…Œì´ì…˜ ê°•í™”
           - EDR ì†”ë£¨ì…˜ ë„ìž… ë˜ëŠ” ê°•í™”
           - ê³„ì • ì ‘ê·¼ í†µì œ ë° ëª¨ë‹ˆí„°ë§ ê°•í™”
        """)

# 4. ì§ˆì˜ì‘ë‹µ(QA)
elif menu == "ì§ˆì˜ì‘ë‹µ(QA)":
    st.title("ì¹¨í•´ì‚¬ê³  ë¶„ì„ ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œ")
    
    st.markdown("""
    ì¹¨í•´ì‚¬ê³  ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§ˆë¬¸ì„ ìž…ë ¥í•˜ë©´, AIê°€ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.
    êµ¬ì²´ì ì¸ ì§ˆë¬¸ì„ í†µí•´ ì¹¨í•´ì‚¬ê³ ì˜ ë‹¤ì–‘í•œ ì¸¡ë©´ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    """)
    
    # ì‚¬ì „ ì •ì˜ëœ ì§ˆë¬¸ ì˜ˆì‹œ
    example_questions = [
        "ê³µê²©ì˜ ì£¼ìš” ë‹¨ê³„ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
        "ì´ˆê¸° ì ‘ê·¼ì€ ì–´ë–»ê²Œ ì´ë£¨ì–´ì¡Œë‚˜ìš”?",
        "ì–´ë–¤ ë°ì´í„°ê°€ ìœ ì¶œë˜ì—ˆë‚˜ìš”?",
        "ì¶”ì²œí•˜ëŠ” ëŒ€ì‘ ì¡°ì¹˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
        "ê³µê²©ìžëŠ” ëˆ„êµ¬ì¸ê°€ìš”?"
    ]
    
    # ì˜ˆì‹œ ì§ˆë¬¸ í‘œì‹œ
    st.subheader("ì§ˆë¬¸ ì˜ˆì‹œ")
    example_q = st.selectbox("ì˜ˆì‹œ ì§ˆë¬¸ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì§ˆë¬¸ì„ ìž…ë ¥í•˜ì„¸ìš”:", [""] + example_questions)
    
    # ì§ˆë¬¸ ìž…ë ¥
    question = st.text_input("ì§ˆë¬¸:", example_q)
    
    if question:
        with st.spinner("ë‹µë³€ì„ ìƒì„± ì¤‘ìž…ë‹ˆë‹¤..."):
            # ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ RAG + LLM ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ ìˆ˜í–‰
            time.sleep(1)  # ì‘ë‹µ ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜
            answer = simulate_qa(question)
        
        # ë‹µë³€ í‘œì‹œ
        st.subheader("ë‹µë³€")
        st.markdown(f"**Q: {question}**")
        st.markdown(f"**A:** {answer}")
        
        # ê´€ë ¨ ì¦ê±° í‘œì‹œ
        st.subheader("ê´€ë ¨ ì¦ê±°")
        
        # ì¦ê±° íƒ­(ë¡œê·¸, íƒ€ìž„ë¼ì¸, ì°¸ê³ ìžë£Œ)
        tab1, tab2, tab3 = st.tabs(["ê´€ë ¨ ë¡œê·¸", "íƒ€ìž„ë¼ì¸ ìƒê´€ê´€ê³„", "ì°¸ê³  ë¬¸ì„œ"])
        
        with tab1:
            # ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ë¡œê·¸ í‘œì‹œ (ì‹œë®¬ë ˆì´ì…˜)
            if "ì´ˆê¸° ì ‘ê·¼" in question:
                filtered_logs = logs_df[logs_df["ì´ë²¤íŠ¸"].isin(["ë¡œê·¸ì¸ ì‹œë„", "ì ‘ê·¼ ê±°ë¶€"])]
            elif "ê¶Œí•œ" in question:
                filtered_logs = logs_df[logs_df["ì´ë²¤íŠ¸"].isin(["ê¶Œí•œ ë³€ê²½", "ê³„ì • ìƒì„±"])]
            elif "ë°ì´í„°" in question or "ìœ ì¶œ" in question:
                filtered_logs = logs_df[logs_df["ì´ë²¤íŠ¸"].isin(["ë°ì´í„° ìœ ì¶œ ì‹œë„", "íŒŒì¼ ìˆ˜ì •"])]
            else:
                filtered_logs = logs_df.sample(5)  # ë¬´ìž‘ìœ„ ìƒ˜í”Œ
            
            st.dataframe(filtered_logs)
        
        with tab2:
            # ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ íƒ€ìž„ë¼ì¸ ë‹¨ê³„ ê°•ì¡°
            highlight_stages = []
            
            if "ì´ˆê¸° ì ‘ê·¼" in question:
                highlight_stages = ["ì´ˆê¸° ì ‘ê·¼"]
            elif "ê¶Œí•œ" in question:
                highlight_stages = ["ê¶Œí•œ ìƒìŠ¹"]
            elif "ì •ì°°" in question:
                highlight_stages = ["ë‚´ë¶€ ì •ì°°"]
            elif "ìˆ˜ì§‘" in question:
                highlight_stages = ["ë°ì´í„° ìˆ˜ì§‘"]
            elif "ìœ ì¶œ" in question:
                highlight_stages = ["ë°ì´í„° ìœ ì¶œ"]
            elif "ë‹¨ê³„" in question or "ê³¼ì •" in question:
                highlight_stages = timeline_df["ë‹¨ê³„"].tolist()
            
            # ê°„ì†Œí™”ëœ íƒ€ìž„ë¼ì¸ í‘œì‹œ
            highlighted_timeline = timeline_df.copy()
            highlighted_timeline["ê°•ì¡°"] = highlighted_timeline["ë‹¨ê³„"].apply(lambda x: "âœ“" if x in highlight_stages else "")
            
            st.dataframe(highlighted_timeline[["ë‹¨ê³„", "ì‹œìž‘ì‹œê°„", "ì¢…ë£Œì‹œê°„", "ê°•ì¡°", "ë¡œê·¸ìˆ˜"]])
        
        with tab3:
            # ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ì°¸ê³  ë¬¸ì„œ (ì‹œë®¬ë ˆì´ì…˜)
            st.markdown("#### ê´€ë ¨ ì°¸ê³  ë¬¸ì„œ")
            
            if "ì´ˆê¸° ì ‘ê·¼" in question:
                st.markdown("""
                - **[MITRE ATT&CK] Initial Access**: í”¼ì‹±, ë“œë¼ì´ë¸Œ ë°”ì´ ë‹¤ìš´ë¡œë“œ ë“± ë‹¤ì–‘í•œ ì´ˆê¸° ì ‘ê·¼ ê¸°ë²•ì— ëŒ€í•œ ì„¤ëª…
                - **[ì¹¨í•´ì‚¬ê³  ëŒ€ì‘ ê°€ì´ë“œ] ì´ˆê¸° ì¹¨í•´ íƒì§€ ë°©ë²•**: ì´ˆê¸° ì ‘ê·¼ ë‹¨ê³„ì—ì„œì˜ ì¹¨í•´ íƒì§€ ê¸°ë²•
                - **[ë³´ì•ˆ ë³´ê³ ì„œ] í”¼ì‹± ê³µê²©ì„ í†µí•œ APT ì¹¨í•´ì‚¬ë¡€ ë¶„ì„**: ìœ ì‚¬ ì‚¬ë¡€ ë¶„ì„ ë³´ê³ ì„œ
                """)
            elif "ê¶Œí•œ ìƒìŠ¹" in question:
                st.markdown("""
                - **[MITRE ATT&CK] Privilege Escalation**: ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•œ ë‹¤ì–‘í•œ ê¸°ë²•
                - **[ì·¨ì•½ì  ë³´ê³ ì„œ] CVE-2023-XXXX**: ì´ë²ˆ ê³µê²©ì— ì‚¬ìš©ëœ ê²ƒìœ¼ë¡œ ì¶”ì •ë˜ëŠ” ì·¨ì•½ì  ìƒì„¸
                - **[ë³´ì•ˆ ê°€ì´ë“œ] ê¶Œí•œ ìƒìŠ¹ ê³µê²© ë°©ì–´ ê¸°ë²•**: ê¶Œí•œ ìƒìŠ¹ ê³µê²© ë°©ì–´ë¥¼ ìœ„í•œ ê¶Œìž¥ ì¡°ì¹˜
                """)
            elif "ë°ì´í„° ìœ ì¶œ" in question:
                st.markdown("""
                - **[MITRE ATT&CK] Exfiltration**: ë°ì´í„° ìœ ì¶œ ê¸°ë²• ë° íƒì§€ ë°©ë²•
                - **[ë°ì´í„° ë³´í˜¸ ê°€ì´ë“œ] ë°ì´í„° ìœ ì¶œ íƒì§€ ë° ë°©ì§€**: ë°ì´í„° ìœ ì¶œ ë°©ì§€ë¥¼ ìœ„í•œ ê¸°ìˆ ì  ì¡°ì¹˜
                - **[ìœ„í˜‘ ì¸í…”ë¦¬ì „ìŠ¤] APT-X ê·¸ë£¹ì˜ ë°ì´í„° ìœ ì¶œ ì „ìˆ **: ìœ ì‚¬ ê³µê²© ê·¸ë£¹ì˜ ë°ì´í„° ìœ ì¶œ íŒ¨í„´
                """)
            else:
                st.markdown("""
                - **[MITRE ATT&CK í”„ë ˆìž„ì›Œí¬]**: ì‚¬ì´ë²„ ê³µê²© ì „ìˆ  ë° ê¸°ë²• ë¶„ë¥˜
                - **[ì¹¨í•´ì‚¬ê³  ëŒ€ì‘ ê°€ì´ë“œ]**: ì¹¨í•´ì‚¬ê³  ëŒ€ì‘ì„ ìœ„í•œ ë‹¨ê³„ë³„ ê°€ì´ë“œ
                - **[ì‚¬ì´ë²„ ìœ„í˜‘ ì¸í…”ë¦¬ì „ìŠ¤ ë³´ê³ ì„œ]**: ìµœì‹  ì‚¬ì´ë²„ ìœ„í˜‘ ë™í–¥ ë° ê³µê²© ê·¸ë£¹ ì •ë³´
                """)
        
        # ì¶”ê°€ ì§ˆë¬¸ ì œì•ˆ
        st.subheader("ì¶”ê°€ ì§ˆë¬¸ ì œì•ˆ")
        suggested_questions = []
        
        if "ì´ˆê¸° ì ‘ê·¼" in question:
            suggested_questions = ["ì´ ê³µê²©ì— ì‚¬ìš©ëœ í”¼ì‹± ì´ë©”ì¼ì˜ íŠ¹ì§•ì€ ë¬´ì—‡ì¸ê°€ìš”?", "ì´ˆê¸° ì ‘ê·¼ì„ íƒì§€í•˜ê¸° ìœ„í•œ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?"]
        elif "ê¶Œí•œ ìƒìŠ¹" in question:
            suggested_questions = ["ê¶Œí•œ ìƒìŠ¹ì— ì‚¬ìš©ëœ ì·¨ì•½ì ì€ ë¬´ì—‡ì¸ê°€ìš”?", "ê¶Œí•œ ìƒìŠ¹ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ì¡°ì¹˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?"]
        elif "ë°ì´í„° ìœ ì¶œ" in question:
            suggested_questions = ["ë°ì´í„° ìœ ì¶œì„ íƒì§€í•˜ëŠ” ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?", "ìœ ì¶œëœ ë°ì´í„°ì˜ ë³µêµ¬ ê°€ëŠ¥ì„±ì€ ì–´ë–¤ê°€ìš”?"]
        elif "ê³µê²©ìž" in question:
            suggested_questions = ["ì´ ê³µê²© ê·¸ë£¹ì˜ ë‹¤ë¥¸ ê³µê²© ì‚¬ë¡€ëŠ” ì–´ë–¤ ê²ƒì´ ìžˆë‚˜ìš”?", "ì´ ê³µê²© ê·¸ë£¹ì˜ ì¼ë°˜ì ì¸ ëª©í‘œëŠ” ë¬´ì—‡ì¸ê°€ìš”?"]
        else:
            suggested_questions = ["ì´ ì¹¨í•´ì‚¬ê³ ì˜ ì „ì²´ íƒ€ìž„ë¼ì¸ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?", "ì´ ì¹¨í•´ì‚¬ê³ ì™€ ìœ ì‚¬í•œ ê³¼ê±° ì‚¬ë¡€ê°€ ìžˆë‚˜ìš”?"]
        
        for sq in suggested_questions:
            if st.button(f"ðŸ” {sq}"):
                # ë²„íŠ¼ í´ë¦­ ì‹œ í•´ë‹¹ ì§ˆë¬¸ìœ¼ë¡œ í…ìŠ¤íŠ¸ ìž…ë ¥ í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•˜ë‚˜,
                # Streamlitì˜ í•œê³„ë¡œ íŽ˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°œìƒ. ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„¸ì…˜ ìƒíƒœ í™œìš© í•„ìš”
                st.session_state.question = sq
                st.experimental_rerun()
